---
import Layout from "@/layouts/Layout.astro";
import BenchmarkViewer from "@/components/BenchmarkViewer";
import { readdirSync, readFileSync } from "fs";
import { join } from "path";

/**
 * Benchmark Results Viewer
 * Displays all benchmark test results in a beautiful, informative dashboard
 */

const resultsDir = join(process.cwd(), "..", "benchmark", "results");
let benchmarkRuns: any[] = [];

try {
  const files = readdirSync(resultsDir);

  // Load baseline benchmark results
  benchmarkRuns = files
    .filter((f) => f.startsWith("baseline-") && f.endsWith(".json"))
    .map((f) => {
      const content = readFileSync(join(resultsDir, f), "utf-8");
      return JSON.parse(content);
    })
    .sort(
      (a, b) =>
        new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime(),
    );
} catch (error) {
  console.warn("No benchmark results found:", error);
}
---

<Layout>
  <div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
    <!-- Header -->
    <header class="bg-white shadow-md">
      <div class="container mx-auto px-4 py-6">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold text-gray-800">
              ğŸ“Š Benchmark Results
            </h1>
            <p class="mt-2 text-gray-600">
              Performance metrics and analysis
            </p>
          </div>
          <a
            href="/"
            class="rounded-lg bg-blue-600 px-4 py-2 font-medium text-white hover:bg-blue-700"
          >
            â† Back to Home
          </a>
        </div>
      </div>
    </header>

    <main class="container mx-auto px-4 py-8">
      <BenchmarkViewer
        benchmarkRuns={benchmarkRuns}
        client:load
      />

      {/* Legend */}
      <div class="mt-8 rounded-lg bg-blue-50 p-4">
        <h3 class="mb-2 font-semibold text-blue-900">ğŸ“– Metrics Guide</h3>
        <div class="grid grid-cols-1 gap-2 text-sm md:grid-cols-2">
          <div>
            <strong class="text-blue-800">Req/sec:</strong>
            <span class="ml-1 text-blue-700">
              Requests per second (throughput)
            </span>
          </div>
          <div>
            <strong class="text-blue-800">Mean:</strong>
            <span class="ml-1 text-blue-700">Average latency</span>
          </div>
          <div>
            <strong class="text-blue-800">P95:</strong>
            <span class="ml-1 text-blue-700">
              95% of requests faster than this
            </span>
          </div>
          <div>
            <strong class="text-blue-800">P99:</strong>
            <span class="ml-1 text-blue-700">
              99% of requests faster than this
            </span>
          </div>
        </div>
        <div class="mt-3 text-sm text-blue-700">
          <strong>Color Coding:</strong>
          <span class="ml-2 text-green-600">â— Green = Excellent</span>
          <span class="ml-2 text-yellow-600">â— Yellow = Good</span>
          <span class="ml-2 text-red-600">â— Red = Needs Attention</span>
        </div>
      </div>
    </main>
  </div>
</Layout>